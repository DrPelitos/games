<!doctype html><html><head><meta charset=utf8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Couch 2048</title><style>#container,#menu{position:absolute}#end,#home,#load,.opt,.opt::after,.opt::before{box-sizing:border-box}body,html{background:#263238;height:100%;margin:0;overflow:hidden;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}#container>*,label{-moz-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}#backcanvas,#canvas,#end,#home,#load{display:block;height:100%;left:0;position:absolute;top:0;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);width:100%}#backcanvas{background:#455a64}#end,#home,#load{background:rgba(0,0,0,.5);color:#fff;cursor:default;font:300 64px/96px 'Segoe UI','Helvetica Neue',sans-serif;height:1080px;padding:0 100px;transform-origin:0 0;width:1920px}#load+#home{display:none}#end>*,#home>*,#load>*{margin:40px 0}h1{font:300 96px/1 'Segoe UI','Helvetica Neue',sans-serif;margin-top:80px;text-shadow:2px 0 0 red,-2px 0 0 #0ff}p{text-shadow:1px 0 0 red,-1px 0 0 #0ff}#reset,#start{-webkit-animation:blink .7s steps(2,start) infinite;animation:blink .7s steps(2,start) infinite;background:#e1ff5f;border-radius:2px;color:#202020;cursor:pointer;display:inline-block;font-size:48px;font-weight:700;outline:4px;outline-offset:4px;padding:40px 120px}#reset:hover,#start:hover,.opt::after{background:#fff}@-webkit-keyframes blink{to{outline:#E1FF5F solid 4px}}@keyframes blink{to{outline:#E1FF5F solid 4px}}#menu{right:0;top:0;transform:translate3d(0,0,0);width:550px}.opt{height:48px;margin:0 10px;outline:0;position:relative;width:80px}.opt::after,.opt::before{border-radius:100px;content:'';display:inline-block;transition:all .2s}.opt::after{border:2px solid #607d8b;height:40px;left:4px;position:absolute;top:4px;width:40px}.opt::before{background:#b0bec5;height:48px;width:80px}.opt:checked::after{left:36px}.opt:checked::before{background:#c6ff00}label{color:#eeff41}body.mobile #menu>*{display:none}#q{display:inline-block!important}#q+label{display:inline!important}</style></head><body><div id=container><canvas id=backcanvas></canvas><canvas id=canvas></canvas><div id=load><h1>Loading</h1></div><div id=home><h1>Couch 2048</h1><p><b>How to play:</b><br>⭐️ Drag pieces around<br>⭐️ Stack those with the same number<br>⭐️ Get to 2048 to win the game<br>⭐️ REVEL IN GLORY <small>(optional but recommended)</small></p><div id=start>NEW GAME</div><div id=menu><input type=checkbox class=opt id=m checked><label for=m>Music</label><br><input type=checkbox class=opt id=s checked><label for=s>Sound FX</label><br><input type=checkbox class=opt id=q checked><label for=q>High Quality</label></div></div><div id=end style=display:none><h1>You win</h1><p><b>Let's party!</b><br><small>Success is commemorated; failure merely remembered</small><br>Written for js13kGames–2016</p><div id=reset>PLAY AGAIN</div></div</div><script>!function(){function r(){this.A=function(r){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=r[e]||0;.01>this.c&&(this.c=.01),.18>(r=this.b+this.c+this.e)&&(r=.18/r,this.b*=r,this.c*=r,this.e*=r)}}var e=new function(){var e,t,a,i,s,n,h,c,f,o,u,b;this.z=new r,this.reset=function(){var r=this.z;i=100/(r.f*r.f+.001),s=100/(r.g*r.g+.001),n=1-.01*r.h*r.h*r.h,h=1e-6*-r.i*r.i*r.i,r.a||(u=.5-r.n/2,b=5e-5*-r.o),c=1+r.l*r.l*(0<r.l?-.9:10),f=0,o=1==r.m?0:2e4*(1-r.m)*(1-r.m)+32},this.C=function(){this.reset();var r=this.z;return e=1e5*r.b*r.b,t=1e5*r.c*r.c,a=1e5*r.e*r.e+12,3*((e+t+a)/3|0)},this.B=function(r,v){var w=1!=(I=this.z).s||I.v,k=.1*I.v*I.v,d=1+3e-4*I.w,g=.1*I.s*I.s*I.s,A=1+1e-4*I.t,l=1!=I.s,m=I.x*I.x,y=I.g,z=I.q||I.r,q=.2*I.r*I.r*I.r,C=I.q*I.q*(0>I.q?-1020:1020),M=I.p?32+(2e4*(1-I.p)*(1-I.p)|0):0,U=I.d,p=I.j/2,x=.01*I.k*I.k,B=I.a,S=e,j=1/e,D=1/t,N=1/a;.8<(I=5/(1+20*I.u*I.u)*(.01+g))&&(I=.8);for(var O,E,F,G,H,I=1-I,J=!1,K=0,L=0,P=0,Q=0,R=0,T=0,V=0,W=0,X=0,Y=0,Z=Array(1024),$=Array(32),_=Z.length;_--;)Z[_]=0;for(_=$.length;_--;)$[_]=2*Math.random()-1;for(_=0;_<v;_++){if(J)return _;if(M&&++X>=M&&(X=0,this.reset()),o&&++f>=o&&(o=0,i*=c),(i*=n+=h)>s&&(i=s,0<y&&(J=!0)),E=i,0<p&&(Y+=x,E*=1+Math.sin(Y)*p),8>(E|=0)&&(E=8),B||(0>(u+=b)?u=0:.5<u&&(u=.5)),++L>S)switch(L=0,++K){case 1:S=t;break;case 2:S=a}switch(K){case 0:P=L*j;break;case 1:P=1+2*(1-L*D)*U;break;case 2:P=1-L*N;break;case 3:P=0,J=!0}z&&(0>(F=0|(C+=q))?F=-F:1023<F&&(F=1023)),w&&d&&(1e-5>(k*=d)?k=1e-5:.1<k&&(k=.1)),H=0;for(var rr=8;rr--;){if(++V>=E&&(V%=E,3==B))for(O=$.length;O--;)$[O]=2*Math.random()-1;switch(B){case 0:G=V/E<u?.5:-.5;break;case 1:G=1-V/E*2;break;case 2:G=.225*((0>(G=1.27323954*(G=6.28318531*(.5<(G=V/E)?G-1:G))+.405284735*G*G*(0>G?1:-1))?-1:1)*G*G-G)+G;break;case 3:G=$[Math.abs(32*V/E|0)]}w&&(O=T,0>(g*=A)?g=0:.1<g&&(g=.1),l?(R+=(G-T)*g,R*=I):(T=G,R=0),Q+=(T+=R)-O,G=Q*=1-k),z&&(Z[W%1024]=G,G+=Z[(W-F+1024)%1024],W++),H+=G}H*=.125*P*m,r[_]=1<=H?32767:-1>=H?-32768:32767*H|0}return v}};window.SOUND=function(r){e.z.A(r);var t=e.C();r=new Uint8Array(4*((t+1)/2|0)+44),t=2*e.B(new Uint16Array(r.buffer,44),t);(a=new Uint32Array(r.buffer,0,44))[0]=1179011410,a[1]=t+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=t;t+=44;for(var a=0,i="data:audio/wav;base64,",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";a<t;a+=3){var n=r[a]<<16|r[a+1]<<8|r[a+2];i=i+(s[n>>18]+s[n>>12&63]+s[n>>6&63]+s[63&n])}return i}}();!function(){function t(){T.clearRect(0,0,q,b),T.save(),T.shadowColor="rgba(0,0,0,0.4)",T.shadowBlur=25,g.paint(T,"#0091EA"),T.shadowColor="#000",T.translate(0,1),tt.paint(T,"rgba(55,71,79,0.4)"),et.paint(T,"rgba(55,71,79,0.4)"),nt.paint(T,"rgba(55,71,79,0.4)"),T.restore()}function e(t,e,n){t.style[e]=n+"px"}function n(){var t=window.innerWidth,n=window.innerHeight;t/n>E?t=n*E:n=t/E,M=q/t,e(L,"width",t),e(L,"height",n),e(L,"left",.5*(window.innerWidth-t)),e(L,"top",.5*(window.innerHeight-n));var o=.5*t/q,s="scale3d("+o+","+o+",1)";A.style[B]=s,O.style[B]=s}function o(t){var e=t.target;"INPUT"!=e.tagName&&"LABEL"!=e.tagName&&(t.preventDefault(),t.stopPropagation())}function s(){L.removeChild(A),l.play("new"),(_||M>1)&&document.body.requestFullscreen&&document.body.requestFullscreen()}function i(){O.style.display="none",l.play("new"),X=[],Y=[],G=[],J=null,it.dragging=!1,a()}function r(){return(.3*Math.random()+.35)*q}function a(){for(var t=2;t<=2048;t*=2)Z[t]=0;tt=new p(280,480,400,60),et=new p(220,420,60,120),nt=new p(680,420,60,120),new u(tt,tt.handle0,et.handle0,.1),new u(tt,tt.handle1,nt.handle1,.1);var e=.5*b;new x(.35*q,e),new x(.65*q,e)}function c(t){it.x=(t.clientX-L.offsetLeft)*M,it.y=(t.clientY-L.offsetTop)*M}var f=function(){function t(){this.on=!0,this.sounds={}}return t.prototype.add=function(t,e,n){this.sounds[t]={tick:0,count:e,pool:[]};for(var o=0;o<e;++o){var s=new Audio;s.src=window.SOUND(n),this.sounds[t].pool.push(s)}},t.prototype.play=function(t){if(this.on){var e=this.sounds[t];e.pool[e.tick].play(),++e.tick>=e.count&&(e.tick=0)}},t}(),l=new f,_=null!=navigator.userAgent.match(/Android|iPhone|iPad/i);_?l.on=!1:(l.add("bip",9,[1,,.1241,,.1855,.5336,,,,,,,,,,,,,1,,,.1,,.64]),l.add("die",4,[1,.0013,.3576,.0681,.8007,.5117,,-.3453,.0049,.148,-.2563,-.2717,.2608,,-.3543,-.1884,-.0106,-.0281,.9971,-.6629,-.7531,.0097,-.0086,.5]),l.add("new",2,[1,,.2548,,.1007,.7539,.0996,-.5302,,,,,,.7769,-.4436,,,,1,,,,,.5]),l.add("win",1,[1,.0309,.5597,.0464,.7472,.369,,-.1366,,-.3111,,-.1581,-.8665,,-.0414,.2802,.0258,-.1198,.9955,.1759,,,-5e-4,.64]));var h=function(){function t(t){void 0===t&&(t=1),this.vertices=[],this.positions=[],this.constraints=[],this.boundaries=[],this.center=new w,this.halfExtents=new w,this.mass=t}return t.prototype.boundingBox=function(){for(var t=99999,e=99999,n=-99999,o=-99999,s=0,i=this.positions;s<i.length;s++){var r=i[s];r.x<t&&(t=r.x),r.y<e&&(e=r.y),r.x>n&&(n=r.x),r.y>o&&(o=r.y)}this.center.set(.5*(t+n),.5*(e+o)),this.halfExtents.set(.5*(n-t),.5*(o-e))},t.prototype.project=function(t){this._min=99999,this._max=-99999;for(var e=0,n=this.positions;e<n.length;e++){var o=n[e].dot(t);o<this._min&&(this._min=o),o>this._max&&(this._max=o)}},t.prototype.drag=function(){if(it.dragging&&!J&&S.isPointInPath(it.x,it.y))for(var t=99999,e=0,n=this.vertices;e<n.length;e++){var o=n[e],s=o.position.distance(it);s<t&&(t=s,J=o)}},t}(),u=function(){function t(t,e,n,o,s){void 0===s&&(s=!1),this.parent=t,this.v0=e,this.v1=n,this.p0=e.position,this.p1=n.position,this.length=this.p0.distance(this.p1),this.stiffness=o,this.isBoundary=s,t.constraints.push(this),s&&t.boundaries.push(this),G.push(this)}return t.prototype.solve=function(){K.setSubtract(this.p0,this.p1);var t=K.length();t&&(K.multiplyScalar(this.stiffness*(this.length-t)/t),this.p0.add(K),this.p1.subtract(K))},t}(),d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},p=function(t){function e(n,o,s,i,r){void 0===r&&(r=!0),t.call(this,250);var a=this.handle0=new y(this,n,o+e.chamfer),c=new y(this,n+e.chamfer,o),f=new y(this,n+s-e.chamfer,o),l=this.handle1=new y(this,n+s,o+e.chamfer),_=new m(this,n+s,o+i),h=new m(this,n,o+i);new u(this,a,c,.1,!0),new u(this,c,f,.1,!0),new u(this,f,l,.1,!0),new u(this,l,_,.1,!0),new u(this,_,h,.1,!0),new u(this,h,a,.1,!0),new u(this,a,l,.1),new u(this,a,_,.1),new u(this,c,_,.1),new u(this,c,h,.1),new u(this,f,_,.1),new u(this,f,h,.1),new u(this,l,h,.1),r&&X.push(this)}return d(e,t),e.prototype.paint=function(t,e){t.beginPath();var n=this.positions[0],o=this.positions[1];t.moveTo(.5*(n.x+o.x),.5*(n.y+o.y));for(var s=1;s<=6;++s)4!=s&&5!=s?(n=this.positions[s%6],o=this.positions[(s+1)%6],t.quadraticCurveTo(n.x,n.y,.5*(n.x+o.x),.5*(n.y+o.y))):t.lineTo(this.positions[s].x,this.positions[s].y);t.fillStyle=e||"#00B0FF",t.fill()},e.prototype.paintLow=function(t,e){t.beginPath();for(var n=0,o=this.positions;n<o.length;n++){var s=o[n];t.lineTo(s.x,s.y)}t.fillStyle=e||"#00B0FF",t.fill()},e.chamfer=10,e}(h),v=(d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},{});["eee4da","ede0c8","f2b179","f59563","f67c5f","f65e3b","edcf72","edcc61","edc850","edc53f","edc22e"].forEach((function(t,e){v[Math.pow(2,e+1)]="#"+t}));var x=function(t){function e(e,n,o,s){void 0===n&&(n=-40),void 0===o&&(o=2),void 0===s&&(s=!0),t.call(this,1+.2*Math.log10(o)),++Z[this.n=o],this.r=40+4*(Math.log2(o)-1),this.font="bold "+(.1*this.r+28)+"px 'Segoe UI','Helvetica Neue',sans-serif";for(var i=function(t){return Math.min((0|.04*Math.PI*t)<<1,16)}(this.r),r=2*Math.PI/i,a=0;a<i;++a){var c=a*r;new y(this,e+this.r*Math.cos(c),n+this.r*Math.sin(c))}for(a=0;a<i-1;++a)for(var f=a+1;f<i;++f)new u(this,this.vertices[a],this.vertices[f],.005,f==a+1);s&&(this.boundingBox(),X.push(this))}return d(e,t),e.prototype.paint=function(t){t.beginPath();var e=this.positions[0],n=this.positions[1];t.moveTo(.5*(e.x+n.x),.5*(e.y+n.y));for(var o=1;o<=this.positions.length;++o)e=this.positions[o%this.positions.length],n=this.positions[(o+1)%this.positions.length],t.quadraticCurveTo(e.x,e.y,.5*(e.x+n.x),.5*(e.y+n.y));t.fillStyle=v[this.n],t.fill(),t.save(),t.translate(this.center.x,this.center.y),t.rotate(Math.atan2(e.y-this.center.y,e.x-this.center.x)),t.font=this.font,t.fillStyle=this.n>4?"#f9f6f2":"#776e65",t.fillText(""+this.n,0,0),t.restore(),this.drag()},e.prototype.paintLow=function(t){t.beginPath();var e=this.boundaries[0].p0;t.moveTo(e.x,e.y);for(var n=0,o=this.boundaries;n<o.length;n++){var s=o[n].p1;t.lineTo(s.x,s.y)}t.fillStyle=v[this.n],t.fill(),t.save(),t.translate(this.center.x,this.center.y),t.rotate(Math.atan2(e.y-this.center.y,e.x-this.center.x)),t.font=this.font,t.fillStyle=this.n>4?"#f9f6f2":"#776e65",t.fillText(""+this.n,0,0),t.restore(),this.drag()},e}(h),y=function(){function t(t,e,n){this.parent=t,this.position=new w(e,n),this.oldPosition=new w(e,n),t.vertices.push(this),t.positions.push(this.position),Y.push(this)}return t.prototype.integrate=function(){var t=this.position,e=this.oldPosition,n=t.x,o=t.y;t.x+=t.x-e.x,t.y+=t.y-e.y+R,e.set(n,o),t.y<-100?t.y=-100:t.y>=P.height+250&&(t.x-=(t.x-e.x)*z,t.y=P.height-1),t.x<0?t.x=0:t.x>=P.width&&(t.x=P.width-1)},t}(),m=(d=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},function(t){function e(e,n,o){t.call(this,e,n,o),this.x=n,this.y=o}return d(e,t),e.prototype.integrate=function(){this.position.set(this.x,this.y),this.oldPosition.set(this.x,this.y)},e}(y)),w=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){this.x=t,this.y=e},t.prototype.setTo=function(t){this.x=t.x,this.y=t.y},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.setSubtract=function(t,e){this.x=t.x-e.x,this.y=t.y-e.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.multiplyScalar=function(t){this.x*=t,this.y*=t},t.prototype.setMultiplyScalar=function(t,e){this.x=t.x*e,this.y=t.y*e},t.prototype.setNormal=function(t,e){var n=t.y-e.y,o=e.x-t.x,s=Math.sqrt(n*n+o*o);if(s<Number.MIN_VALUE)return this.x=n,void(this.y=o);var i=1/s;this.x=n*i,this.y=o*i},t}(),g=null,q=960,b=540,E=16/9,M=1,L=document.getElementById("container"),k=document.getElementById("backcanvas"),P=document.getElementById("canvas"),T=k.getContext("2d"),S=P.getContext("2d"),B="transform";B in L.style||(B="webkitTransform"),k.width=P.width=q,k.height=P.height=b,S.lineWidth=2,S.textAlign="center",S.textBaseline="middle",window.addEventListener("resize",n),window.addEventListener("orientationchange",n),P.addEventListener("contextmenu",(function(t){t.preventDefault()}));var I=function(){var t,e,n,o=new w;return[function(s,i){if(Math.abs(i.center.x-s.center.x)-(s.halfExtents.x+i.halfExtents.x)>=0||Math.abs(i.center.y-s.center.y)-(s.halfExtents.y+i.halfExtents.y)>=0)return!1;t=99999;for(var r=0,a=[s,i];r<a.length;r++)for(var c=0,f=a[r].boundaries;c<f.length;c++){var l=f[c];if(K.setNormal(l.p0,l.p1),s.project(K),i.project(K),(p=s._min<i._min?i._min-s._max:s._min-i._max)>0)return!1;(p*=-1)<t&&(t=p,o.setTo(K),e=l)}if(e.parent!=i){var _=s;s=i,i=_}K.setSubtract(s.center,i.center),K.dot(o)<0&&o.multiplyScalar(-1);for(var h=99999,u=0,d=s.vertices;u<d.length;u++){var p,v=d[u];K.setSubtract(v.position,i.center),(p=o.dot(K))<h&&(h=p,n=v)}return!0},function(){var s=e.p0,i=e.p1,r=e.v0.oldPosition,a=e.v1.oldPosition,c=n.position,f=n.oldPosition;K.setMultiplyScalar(o,t);var l=Math.abs(s.x-i.x)>Math.abs(s.y-i.y)?(c.x-K.x-s.x)/(i.x-s.x):(c.y-K.y-s.y)/(i.y-s.y),_=1/(l*l+(1-l)*(1-l)),h=n.parent.mass,u=e.parent.mass,d=h+u;u/=d;var p=(1-l)*_*(h/=2*d),v=l*_*h;s.x-=K.x*p,s.y-=K.y*p,i.x-=K.x*v,i.y-=K.y*v,c.x+=K.x*u,c.y+=K.y*u,K.set(c.x-f.x-.5*(s.x+i.x-r.x-a.x),c.y-f.y-.5*(s.y+i.y-r.y-a.y)),Q.set(-o.y,o.x),K.setMultiplyScalar(Q,K.dot(Q)),r.x-=K.x*W*p,r.y-=K.y*W*p,a.x-=K.x*W*v,a.y-=K.y*W*v,f.x+=K.x*W*u,f.y+=K.y*W*u}]}(),D=I[0],F=I[1],N=document.getElementById("load"),A=document.getElementById("home"),C=document.getElementById("start"),O=document.getElementById("end"),j=document.getElementById("reset");A.addEventListener("mousedown",o),A.addEventListener("touchstart",o),C.addEventListener("mousedown",s),C.addEventListener("touchstart",s),O.addEventListener("mousedown",o),O.addEventListener("touchstart",o),j.addEventListener("mousedown",i),j.addEventListener("touchstart",i);var R=.6,U=.1,H=40,W=.9,z=.6,V=.24,X=[],Y=[],G=[],J=null,K=new w,Q=new w,Z={},$=function(t,e){var n,o=null;return function(){n=Date.now(),o||(o=setTimeout((function s(){var i=Date.now()-n;i<e?o=setTimeout(s,e-i):(o=null,t())}),e))}}((function(){var t=Z[256]||Z[512]||Z[1024];Z[2]?new x(r()):Z[4]?new x(r(),-44,4):t?Z[8]?new x(r(),-48,8):(new x(.35*q,-44,4),new x(.65*q,-44,4)):(new x(.35*q),new x(.65*q)),l.play("new")}),300),tt=null,et=null,nt=null,ot=function(){function t(t){return Math.sin(6.283184*t)}function e(e){return t(e)<0?-1:1}function n(t){return t%1-.5}function o(t){var e=t%1*4;return e<2?e-1:3-e}function s(t){return.00390625*Math.pow(1.059463094,t-128)}var i,r,a=44100,c=a*st.songLen;!function(){var t=Math.ceil(Math.sqrt(2*c/2)),e=document.createElement("canvas").getContext("2d");i=e.createImageData(t,t).data;var n,o=e.createImageData(t,t).data;for(n=t*t*4-2;n>=0;n-=2)o[n]=0,o[n+1]=128;r=o}(),this.lps=a/st.rowLen,this.generate=function(f){var l,_,h,u,d,p,v,x,y,m,w,g,q,b,E,M,L,k,P,T,S,B,I=[t,e,n,o],D=i,F=r,N=c,A=2*c*2,C=st.songData[f],O=st.rowLen,j=I[C.lfo_waveform],R=I[C.osc1_waveform],U=I[C.osc2_waveform],H=C.env_attack,W=C.env_sustain,z=C.env_release,V=Math.pow(2,C.fx_pan_freq-8)/O,X=Math.pow(2,C.lfo_freq-8)/O;for(h=0;h<A;h+=2)D[h]=0,D[h+1]=128;for(v=0,u=0;u<st.endPattern-1;++u)for(x=C.p[u],d=0;d<32;++d){if(x&&(p=C.c[x-1].n[d]))for(y=m=0,S=s(p+12*(C.osc1_oct-8)+C.osc1_det)*(1+8e-4*C.osc1_detune),B=s(p+12*(C.osc2_oct-8)+C.osc2_det)*(1+8e-4*C.osc2_detune),w=C.fx_resonance/255,g=q=0,l=H+W+z-1;l>=0;--l){switch(M=j((_=l+v)*X)*C.lfo_amt/512+.5,L=1,l<H?L=l/H:l>=H+W&&(L-=(l-H-W)/z),E=S,C.lfo_osc1_freq&&(E+=M),C.osc1_xenv&&(E*=L*L),P=R(y+=E)*C.osc1_vol,E=B,C.osc2_xenv&&(E*=L*L),P+=U(m+=E)*C.osc2_vol,C.noise_fader&&(P+=(2*Math.random()-1)*C.noise_fader*L),P*=L/255,T=C.fx_freq,C.lfo_fx_freq&&(T*=M),q+=(T=1.5*Math.sin(3.141592*T/a))*(b=w*(P-q)-(g+=T*q)),C.fx_filter){case 1:P=b;break;case 2:P=g;break;case 3:P=q;break;case 4:P=g+b}E=t(_*V)*C.fx_pan_amt/512+.5,P*=39*C.env_master,k=D[_<<=2]+(D[_+1]<<8)+P*(1-E),D[_]=255&k,D[_+1]=k>>8&255,k=D[_+2]+(D[_+3]<<8)+P*E,D[_+2]=255&k,D[_+3]=k>>8&255}v+=O}for(u=C.fx_delay_time*O>>1,E=C.fx_delay_amt/255,p=0;p<N-u;++p)h=4*p,k=D[_=4*(p+u)]+(D[_+1]<<8)+(D[h+2]+(D[h+3]<<8)-32768)*E,D[_]=255&k,D[_+1]=k>>8&255,k=D[_+2]+(D[_+3]<<8)+(D[h]+(D[h+1]<<8)-32768)*E,D[_+2]=255&k,D[_+3]=k>>8&255;for(h=0;h<A;h+=2)k=F[h]+(F[h+1]<<8)+D[h]+(D[h+1]<<8)-32768,F[h]=255&k,F[h+1]=k>>8&255},this.createAudio=function(){var t,e,n,o,s,a,f,l,_=r,h=2*c*2;for(i=null,a=(s=h-8)-36,o=String.fromCharCode(82,73,70,70,255&s,s>>8&255,s>>16&255,s>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),t=0;t<h;){for(n="",e=0;e<256&&t<h;++e,t+=2)l=(l=4*(_[t]+(_[t+1]<<8)-32768))<-32768?-32768:l>32767?32767:l,n+=String.fromCharCode(255&l,l>>8&255);o+=n}return f="data:audio/wav;base64,"+btoa(o),o=null,new Audio(f)},this.getData=function(t,e){for(var n=Math.floor(t*a),o=0,s=[],i=r;o<2*e;o+=2){var c=4*(n+o)+1;s.push(t>0&&c<i.length?(i[c]+i[c-1]/256)/256:.5)}return s}},st={songLen:37,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9},it={dragging:!1,x:0,y:0};addEventListener("mousedown",(function(t){t.preventDefault(),it.dragging=!0,c(t)})),addEventListener("mousemove",(function(t){t.preventDefault(),c(t)})),addEventListener("mouseup",(function(t){t.preventDefault(),it.dragging=!1,J=null})),document.addEventListener("touchstart",(function(t){var e=t.target;"INPUT"!=e.tagName&&"LABEL"!=e.tagName&&t.preventDefault(),it.dragging=!0,c(t.targetTouches[0])})),document.addEventListener("touchmove",(function(t){t.preventDefault(),c(t.targetTouches[0])})),document.addEventListener("touchend",(function(t){it.dragging=!1,J=null})),document.addEventListener("touchcancel",(function(t){it.dragging=!1,J=null})),Math.log2||(Math.log2=function(t){return Math.log(t)/Math.LN2}),Math.log10||(Math.log10=function(t){return Math.log(t)/Math.LN10}),Date.now||(Date.now=function(){return(new Date).getTime()}),Element.prototype.requestFullscreen||(Element.prototype.requestFullscreen=Element.prototype.mozRequestFullScreen||Element.prototype.msRequestFullscreen||Element.prototype.webkitRequestFullscreen);var rt=null;if(!_)try{!function(){for(var t=new ot,e=0;e<8;++e)t.generate(e);(rt=t.createAudio()).loop=!0,rt.volume=.9}()}catch(t){}n(),function(){_&&(document.body.className="mobile");var e=document.getElementById("m"),n=document.getElementById("s"),o=document.getElementById("q");e.addEventListener("change",(function(t){rt&&(e.checked?(rt.currentTime=0,rt.play()):rt.pause())})),n.addEventListener("change",(function(t){l.on=n.checked}));var s=p.prototype.paint,i=p.prototype.paintLow,r=x.prototype.paint,a=x.prototype.paintLow;_&&(o.checked=!1,p.prototype.paint=i,x.prototype.paint=a),o.addEventListener("change",(function(e){p.prototype.paint=o.checked?s:i,x.prototype.paint=o.checked?r:a,t()})),L.removeChild(N),rt&&rt.play()}(),a(),g=new p(255,360,450,180,!1),requestAnimationFrame((function t(){S.clearRect(0,0,q,b);for(var e=0,n=Y;e<n.length;e++){n[e].integrate()}for(var o,s=!1,i=function(t){var e=X[t];e.center.y>=b+e.r&&(G=G.filter((function(t){return t.parent!=e})),Y=Y.filter((function(t){return t.parent!=e})),J&&J.parent==e&&(J=null,it.dragging=!1),X.splice(t,1),--Z[e.n],l.play("die"),s=!0,--t),o=t},r=3;r<X.length;++r)i(r),r=o;var a=function(t){for(var e=X[t],n=2.5*e.r,o=99999,i=null,r=0,a=t+1;a<X.length;++a){var c=X[a];if(e.n==c.n){var f=e.center.distance(c.center);f<n&&f<o&&(o=f,i=c,r=a)}}if(!i)return"continue";var _=.5*(e.center.x+i.center.x),h=.5*(e.center.y+i.center.y);if(o>2*e.r){for(var u=0,d=e.positions;u<d.length;u++){(y=d[u]).x+=(_-y.x)*U,y.y+=(h-y.y)*U}for(var p=0,v=i.positions;p<v.length;p++){var y;(y=v[p]).x+=(_-y.x)*U,y.y+=(h-y.y)*U}}else G=G.filter((function(t){return t.parent!=e&&t.parent!=i})),Y=Y.filter((function(t){return t.parent!=e&&t.parent!=i})),!J||J.parent!=e&&J.parent!=i||(J=null,it.dragging=!1),X.splice(r,1),X[t]=new x(_,h,e.n<<1,!1),Z[e.n]-=2,l.play("bip"),s=!0,1024==e.n&&(O.style.display="block",l.play("win"))};for(r=3;r<X.length-1;++r)a(r);s&&$(),J&&(J.position.x+=(it.x-J.position.x)*V,J.position.y+=(it.y-J.position.y)*V);for(var c=0;c<H;++c){for(var f=0,_=G;f<_.length;f++){_[f].solve()}for(var h=0,u=X;h<u.length;h++){u[h].boundingBox()}for(r=0;r<X.length-1;++r)for(var d=r+1;d<X.length;++d)D(X[r],X[d])&&F()}for(var p=0,v=X;p<v.length;p++){v[p].paint(S)}J&&(S.beginPath(),S.moveTo(J.position.x,J.position.y),S.lineTo(it.x,it.y),S.strokeStyle="#FFD600",S.stroke()),requestAnimationFrame(t)})),t()}()</script></body></html>
